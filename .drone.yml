---
### Autogenerated pipeline! DONT edit! ###
kind: pipeline
name: build-arm64
node_selector:
  kubernetes.io/arch: arm64
platform:
  arch: arm64
  os: linux
  variant: v8
resources:
  requests:
    memory: 256Mi
steps:
- commands:
  - apk --no-cache add binutils
  - CGO_ENABLED=0 go install github.com/go-graphite/go-carbon@latest
  - CGO_ENABLED=0 go install github.com/go-graphite/carbonapi/cmd/carbonapi@latest
  - strip -s /go/bin/*
  - cp /go/bin/go-carbon go-carbon/
  - cp /go/bin/carbonapi carbonapi/
  image: golang:1.18-alpine
  name: build
  pull: always
- image: plugins/docker
  name: go-carbon
  privileged: true
  pull: always
  settings:
    auto_label: false
    auto_tag: true
    auto_tag_suffix: arm64
    context: go-carbon
    dockerfile: go-carbon/Dockerfile
    mirror:
      from_secret: hub_docker_mirror
    password:
      from_secret: ghcr.io.password
    registry: ghcr.io
    repo: ghcr.io/kubernetize/go-graphite/go-carbon
    username: rkojedzinszky
  volumes:
  - name: docker
    path: /var/lib/docker
- image: plugins/docker
  name: carbonapi
  privileged: true
  pull: always
  settings:
    auto_label: false
    auto_tag: true
    auto_tag_suffix: arm64
    context: carbonapi
    dockerfile: carbonapi/Dockerfile
    mirror:
      from_secret: hub_docker_mirror
    password:
      from_secret: ghcr.io.password
    registry: ghcr.io
    repo: ghcr.io/kubernetize/go-graphite/carbonapi
    username: rkojedzinszky
  volumes:
  - name: docker
    path: /var/lib/docker
type: kubernetes
volumes:
- name: docker
  temp: {}
---
### Autogenerated pipeline! DONT edit! ###
kind: pipeline
name: build-amd64
node_selector:
  kubernetes.io/arch: amd64
platform:
  arch: amd64
  os: linux
resources:
  requests:
    memory: 256Mi
steps:
- commands:
  - apk --no-cache add binutils
  - CGO_ENABLED=0 go install github.com/go-graphite/go-carbon@latest
  - CGO_ENABLED=0 go install github.com/go-graphite/carbonapi/cmd/carbonapi@latest
  - strip -s /go/bin/*
  - cp /go/bin/go-carbon go-carbon/
  - cp /go/bin/carbonapi carbonapi/
  image: golang:1.18-alpine
  name: build
  pull: always
- image: plugins/docker
  name: go-carbon
  privileged: true
  pull: always
  settings:
    auto_label: false
    auto_tag: true
    auto_tag_suffix: amd64
    context: go-carbon
    dockerfile: go-carbon/Dockerfile
    mirror:
      from_secret: hub_docker_mirror
    password:
      from_secret: ghcr.io.password
    registry: ghcr.io
    repo: ghcr.io/kubernetize/go-graphite/go-carbon
    username: rkojedzinszky
  volumes:
  - name: docker
    path: /var/lib/docker
- image: plugins/docker
  name: carbonapi
  privileged: true
  pull: always
  settings:
    auto_label: false
    auto_tag: true
    auto_tag_suffix: amd64
    context: carbonapi
    dockerfile: carbonapi/Dockerfile
    mirror:
      from_secret: hub_docker_mirror
    password:
      from_secret: ghcr.io.password
    registry: ghcr.io
    repo: ghcr.io/kubernetize/go-graphite/carbonapi
    username: rkojedzinszky
  volumes:
  - name: docker
    path: /var/lib/docker
type: kubernetes
volumes:
- name: docker
  temp: {}
---
depends_on:
- build-arm64
- build-amd64
kind: pipeline
name: manifest
platform:
  arch: arm64
  os: linux
  variant: v8
steps:
- image: plugins/manifest
  name: ghcr.io/kubernetize/go-graphite/go-carbon
  pull: always
  settings:
    auto_tag: true
    password:
      from_secret: ghcr.io.password
    spec: manifests/ghcr.io-kubernetize-go-graphite-go-carbon.tmpl
    username: rkojedzinszky
- image: plugins/manifest
  name: ghcr.io/kubernetize/go-graphite/carbonapi
  pull: always
  settings:
    auto_tag: true
    password:
      from_secret: ghcr.io.password
    spec: manifests/ghcr.io-kubernetize-go-graphite-carbonapi.tmpl
    username: rkojedzinszky
type: kubernetes
